<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uploader - Bagus Store</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-lg bg-white shadow-lg rounded-lg p-6">
        <h2 class="text-2xl font-bold text-center text-blue-600 mb-4">Upload File ke Bagus Store</h2>

        <!-- Drag & Drop Area -->
        <div id="drop-area" class="border-2 border-dashed border-blue-400 p-6 text-center rounded-lg cursor-pointer bg-blue-50">
            <p class="text-gray-700">Seret dan lepas file di sini atau</p>
            <button id="file-button" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded">Pilih File</button>
            <input type="file" id="file-input" class="hidden">
        </div>

        <!-- Progress Bar -->
        <div id="progress-container" class="hidden mt-4">
            <div class="w-full bg-gray-200 rounded-full">
                <div id="progress-bar" class="h-4 bg-blue-500 rounded-full w-0"></div>
            </div>
            <p id="progress-text" class="text-center text-sm text-gray-700 mt-2">0%</p>
        </div>

        <!-- Hasil Upload -->
        <div id="upload-result" class="hidden mt-4">
            <p class="text-green-600 font-bold">File berhasil diupload!</p>
            <a id="file-link" href="#" target="_blank" class="text-blue-500 underline">Lihat File</a>
        </div>
    </div>

    <script>
        const dropArea = document.getElementById("drop-area");
        const fileButton = document.getElementById("file-button");
        const fileInput = document.getElementById("file-input");
        const progressContainer = document.getElementById("progress-container");
        const progressBar = document.getElementById("progress-bar");
        const progressText = document.getElementById("progress-text");
        const uploadResult = document.getElementById("upload-result");
        const fileLink = document.getElementById("file-link");

        // Klik tombol untuk pilih file
        fileButton.addEventListener("click", () => fileInput.click());

        // Drag & Drop
        dropArea.addEventListener("dragover", (e) => {
            e.preventDefault();
            dropArea.classList.add("bg-blue-100");
        });

        dropArea.addEventListener("dragleave", () => dropArea.classList.remove("bg-blue-100"));

        dropArea.addEventListener("drop", (e) => {
            e.preventDefault();
            dropArea.classList.remove("bg-blue-100");
            const file = e.dataTransfer.files[0];
            uploadFile(file);
        });

        // Pilih file dari input
        fileInput.addEventListener("change", () => {
            const file = fileInput.files[0];
            uploadFile(file);
        });

        function uploadFile(file) {
            if (!file) return;

            let formData = new FormData();
            formData.append("file", file);

            progressContainer.classList.remove("hidden");
            progressBar.style.width = "0%";
            progressText.innerText = "0%";

            fetch("https://cdn.rafaelxd.tech/upload", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.url) {
                    // Ganti domain hasil upload ke bagusxixepen.my.id
                    let customUrl = data.url.replace("cdn.rafaelxd.tech", "bagusxixepen.my.id");

                    uploadResult.classList.remove("hidden");
                    fileLink.href = customUrl;
                    fileLink.innerText = customUrl;
                }
            })
            .catch(error => console.error("Upload gagal:", error));
        }
    </script>

</body>
</html>
